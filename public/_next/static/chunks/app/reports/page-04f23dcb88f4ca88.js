(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[22],{26780:(e,t,a)=>{Promise.resolve().then(a.bind(a,28320))},28320:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var s=a(95155),l=a(12115),r=a(76046),n=a(34696),i=a(46803),o=a(73110),d=a(13901),c=a(32423),m=a(44857),u=a(50878),x=a(36972),p=a(14081),y=a(10142);function g(){let e=(0,r.useRouter)(),{isAuthenticated:t,hasAnyRole:a,loading:g}=(0,n.A)(),{showSuccess:h,showError:b}=(0,i.h)(),[v,f]=(0,l.useState)(!1),[j,N]=(0,l.useState)(null),[D,w]=(0,l.useState)([]),[C,S]=(0,l.useState)(""),[A,k]=(0,l.useState)({startDate:"",endDate:""}),[P,R]=(0,l.useState)("donations");(0,l.useEffect)(()=>{if(!g&&!t()){e.push("/login");return}t()&&!a(["admin","relief_worker"])?(e.push("/dashboard"),b("You do not have permission to access reports")):t()&&L()},[g,t,a,e,b]);let L=async()=>{try{let e=await d.xg.getAll(),t=e.data.data||e.data.calamities||[];w(t)}catch(e){console.error("Error fetching calamities:",e)}},T=async()=>{try{let e;if(f(!0),"calamity"===P&&C){let e=await d.TB.getAll(),t=(e.data.data||e.data.donations||[]).filter(e=>e.calamityId===C),a=await d.xg.getById(C),s=a.data.data||a.data,l=t.filter(e=>"monetary"===e.type),r=t.filter(e=>"in-kind"===e.type),n={totalDonations:t.length,totalAmount:l.reduce((e,t)=>e+(parseFloat(t.amount)||0),0),verifiedDonations:t.filter(e=>"verified"===e.status).length,pendingDonations:t.filter(e=>!e.status||"pending"===e.status).length,deliveredDonations:t.filter(e=>"delivered"===e.status).length,monetaryCount:l.length,inKindCount:r.length},i=t.map(e=>({...e,displayStatus:e.status||"pending"}));N({summary:n,donations:i,calamity:s,type:"calamity"})}else"donations"===P?(e=await d.Pt.getDonationReport(A),N({...e.data,type:"donations"})):"overall"===P&&(e=await d.Pt.getOverallReport(),N({...e.data,type:"overall"}))}catch(e){console.error("Error fetching report data:",e),b("Failed to fetch report data")}finally{f(!1)}};return g?(0,s.jsx)(o.A,{children:(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):(0,s.jsx)(o.A,{children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"Reports"}),(0,s.jsx)("p",{className:"text-gray-600 mt-1",children:"Generate and download comprehensive reports"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Report Configuration"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Report Type"}),(0,s.jsxs)("select",{value:P,onChange:e=>{R(e.target.value),N(null),S("")},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,s.jsx)("option",{value:"donations",children:"Donations Report"}),(0,s.jsx)("option",{value:"calamity",children:"Calamity Report"}),(0,s.jsx)("option",{value:"overall",children:"Overall Report"})]})]}),"calamity"===P&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Calamity"}),(0,s.jsxs)("select",{value:C,onChange:e=>{S(e.target.value),N(null)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,s.jsx)("option",{value:"",children:"Choose a calamity..."}),D.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name||e.title},e.id))]})]}),"calamity"!==P&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(c.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,s.jsx)("input",{type:"date",value:A.startDate,onChange:e=>k(t=>({...t,startDate:e.target.value})),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),"calamity"!==P&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(c.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,s.jsx)("input",{type:"date",value:A.endDate,onChange:e=>k(t=>({...t,endDate:e.target.value})),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)("button",{onClick:T,disabled:v||"calamity"===P&&!C,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:v?"Generating...":"Generate Report"})})]}),j&&(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-800",children:(null==j?void 0:j.type)==="calamity"&&(null==j?void 0:j.calamity)?"".concat(j.calamity.name||j.calamity.title," - Donations Report"):"Report Preview"}),(null==j?void 0:j.type)==="calamity"&&(null==j?void 0:j.calamity)&&(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"All donations related to this calamity"})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)("button",{onClick:()=>{try{var e,t;let a=new y.default;a.setFontSize(20);let s="Disaster Relief Management Report";if((null==j?void 0:j.type)==="calamity"&&(null==j?void 0:j.calamity)&&(s="".concat(j.calamity.name||j.calamity.title," - Report")),a.text(s,14,20),a.setFontSize(10),a.text("Generated: ".concat(new Date().toLocaleString()),14,30),a.setFontSize(12),(null==j?void 0:j.type)==="calamity"&&(null==j?void 0:j.calamity)?a.text("Calamity: ".concat(j.calamity.name||j.calamity.title),14,40):a.text("Report Type: ".concat((null==j?void 0:null===(e=j.type)||void 0===e?void 0:e.toUpperCase())||"REPORT"),14,40),A.startDate&&A.endDate&&a.text("Period: ".concat(A.startDate," to ").concat(A.endDate),14,47),null==j?void 0:j.summary){a.setFontSize(14),a.text("Summary",14,60);let e=[["Total Donations",j.summary.totalDonations||0],["Monetary Donations",j.summary.monetaryCount||0],["In-Kind Donations",j.summary.inKindCount||0],["Total Amount","PHP ".concat((j.summary.totalAmount||0).toLocaleString())],["Verified Donations",j.summary.verifiedDonations||0],["Pending Donations",j.summary.pendingDonations||0],["Delivered Donations",j.summary.deliveredDonations||0]];a.autoTable({startY:65,head:[["Metric","Value"]],body:e,theme:"grid"})}if((null==j?void 0:j.donations)&&j.donations.length>0){a.setFontSize(14);let e=(null===(t=a.lastAutoTable)||void 0===t?void 0:t.finalY)||100;a.text("Donations",14,e+10);let s=j.donations.map(e=>{var t;return[e.type,"monetary"===e.type?"PHP ".concat(e.amount):"".concat(e.itemName," (").concat(e.quantity,")"),(null===(t=e.displayStatus)||void 0===t?void 0:t.replace("_"," "))||"Pending",new Date(e.createdAt).toLocaleDateString()]});a.autoTable({startY:e+15,head:[["Type","Details","Status","Date"]],body:s,theme:"striped"})}a.save("disaster-relief-report-".concat(Date.now(),".pdf")),h("PDF report generated successfully")}catch(e){console.error("Error generating PDF:",e),b("Failed to generate PDF report")}},className:"flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors",children:[(0,s.jsx)(m.A,{className:"w-4 h-4"}),"Download PDF"]}),(0,s.jsxs)("button",{onClick:()=>{try{var e;if(!(null==j?void 0:j.donations)||0===j.donations.length){b("No data available to export");return}let t=["Type","Amount","Item Name","Quantity","Status","Date","Description"];"calamity"===P&&(t=["Calamity","Type","Amount","Item Name","Quantity","Status","Donor","Date","Description"]);let a=j.donations.map(e=>{var t;return[e.type,e.amount||"",e.itemName||"",e.quantity||"",(null===(t=e.displayStatus)||void 0===t?void 0:t.replace("_"," "))||"Pending",new Date(e.createdAt).toLocaleDateString(),e.description||""]});"calamity"===P&&(a=j.donations.map(e=>{var t,a,s;return[(null===(t=j.calamity)||void 0===t?void 0:t.name)||(null===(a=j.calamity)||void 0===a?void 0:a.title)||"N/A",e.type,e.amount||"",e.itemName||"",e.quantity||"",(null===(s=e.displayStatus)||void 0===s?void 0:s.replace("_"," "))||"Pending",e.donorName||"Anonymous",new Date(e.createdAt).toLocaleDateString(),e.description||""]}));let s=[t.join(","),...a.map(e=>e.map(e=>'"'.concat(e,'"')).join(","))].join("\n"),l=new Blob([s],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),n=URL.createObjectURL(l),i="calamity"===P?"calamity-report-".concat((null===(e=j.calamity)||void 0===e?void 0:e.name)||"report","-").concat(Date.now(),".csv"):"disaster-relief-report-".concat(Date.now(),".csv");r.setAttribute("href",n),r.setAttribute("download",i),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),h("CSV report generated successfully")}catch(e){console.error("Error generating CSV:",e),b("Failed to generate CSV report")}},className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[(0,s.jsx)(m.A,{className:"w-4 h-4"}),"Download CSV"]})]})]}),(null==j?void 0:j.type)==="calamity"&&(null==j?void 0:j.calamity)&&(0,s.jsx)("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-blue-600 font-semibold uppercase",children:"Calamity Name"}),(0,s.jsx)("p",{className:"text-lg font-bold text-gray-800 mt-1",children:j.calamity.name||j.calamity.title})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-blue-600 font-semibold uppercase",children:"Status"}),(0,s.jsx)("p",{className:"text-lg font-bold text-gray-800 mt-1 capitalize",children:j.calamity.status||"Unknown"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-blue-600 font-semibold uppercase",children:"Created"}),(0,s.jsx)("p",{className:"text-lg font-bold text-gray-800 mt-1",children:new Date(j.calamity.createdAt).toLocaleDateString()})]})]})}),j.summary&&(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"text-md font-semibold text-gray-800 mb-4",children:"Summary"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,s.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-100",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Total Donations"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:j.summary.totalDonations||0})]}),(0,s.jsxs)("div",{className:"p-4 bg-green-50 rounded-lg border border-green-100",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Total Amount"}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:["₱",(j.summary.totalAmount||0).toLocaleString()]})]}),(0,s.jsxs)("div",{className:"p-4 bg-purple-50 rounded-lg border border-purple-100",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Verified"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:j.summary.verifiedDonations||0})]}),(0,s.jsxs)("div",{className:"p-4 bg-yellow-50 rounded-lg border border-yellow-100",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Pending"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:j.summary.pendingDonations||0})]}),(0,s.jsxs)("div",{className:"p-4 bg-indigo-50 rounded-lg border border-indigo-100",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Delivered"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-indigo-600",children:j.summary.deliveredDonations||0})]})]}),void 0!==j.summary.monetaryCount&&(0,s.jsxs)("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"p-4 bg-orange-50 rounded-lg border border-orange-100",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Monetary Donations"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:j.summary.monetaryCount})]}),(0,s.jsxs)("div",{className:"p-4 bg-pink-50 rounded-lg border border-pink-100",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"In-Kind Donations"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-pink-600",children:j.summary.inKindCount})]})]})]}),j.donations&&j.donations.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-md font-semibold text-gray-800 mb-4",children:["Donations (",j.donations.length,")"]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Item / Amount"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Type"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Quantity"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Donor"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-200",children:j.donations.map(e=>{var t,a,l,r,n,i,o,d,c,m;return(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsxs)("td",{className:"px-4 py-3 text-sm text-gray-900",children:[(0,s.jsx)("div",{className:"font-medium",children:"monetary"===e.type?"₱".concat(null===(t=e.amount)||void 0===t?void 0:t.toLocaleString()):"".concat(e.itemName)}),(0,s.jsx)("div",{className:"text-xs text-gray-500 mt-0.5",children:e.description&&e.description.substring(0,50)})]}),(0,s.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700 capitalize",children:"monetary"===e.type?"Monetary":"In-Kind"}),(0,s.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700",children:"monetary"===e.type?"-":"".concat(e.quantity," items")}),(0,s.jsx)("td",{className:"px-4 py-3 text-sm",children:(0,s.jsxs)("span",{className:"px-2 py-1 text-xs font-medium rounded-full inline-flex items-center gap-1 ".concat((null===(a=e.displayStatus)||void 0===a?void 0:a.toLowerCase())==="delivered"?"bg-green-100 text-green-700":(null===(l=e.displayStatus)||void 0===l?void 0:l.toLowerCase())==="verified"?"bg-blue-100 text-blue-700":(null===(r=e.displayStatus)||void 0===r?void 0:r.toLowerCase())==="in_transit"||(null===(n=e.displayStatus)||void 0===n?void 0:n.toLowerCase())==="out_for_delivery"?"bg-purple-100 text-purple-700":(null===(i=e.displayStatus)||void 0===i?void 0:i.toLowerCase())==="processing"?"bg-indigo-100 text-indigo-700":(null===(o=e.displayStatus)||void 0===o?void 0:o.toLowerCase())==="pending"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"),children:[(null===(d=e.displayStatus)||void 0===d?void 0:d.toLowerCase())==="delivered"&&(0,s.jsx)(u.A,{className:"w-3 h-3"}),(null===(c=e.displayStatus)||void 0===c?void 0:c.toLowerCase())==="pending"&&(0,s.jsx)(x.A,{className:"w-3 h-3"}),(null===(m=e.displayStatus)||void 0===m?void 0:m.replace("_"," "))||"Pending"]})}),(0,s.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700",children:e.donorName||"Anonymous"}),(0,s.jsx)("td",{className:"px-4 py-3 text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString()})]},e.id)})})]})})]})]}),!j&&!v&&(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[(0,s.jsx)(p.A,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"No Report Generated"}),(0,s.jsx)("p",{className:"text-gray-600",children:"calamity"!==P||C?"calamity"===P&&C?"No donations found for the selected calamity":'Configure the report settings above and click "Generate Report" to view data':"Please select a calamity to generate a report"})]})]})})}a(92340)},73110:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var s=a(95155),l=a(12115),r=a(16062),n=a(85524);function i(e){let{children:t}=e,[a,i]=(0,l.useState)(!1);return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(r.A,{onMenuClick:()=>i(!a)}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)(n.A,{isOpen:a,onClose:()=>i(!1)}),(0,s.jsx)("main",{className:"flex-1 p-6 lg:p-8 overflow-x-hidden",children:t})]})]})}},46803:(e,t,a)=>{"use strict";a.d(t,{NotificationProvider:()=>i,h:()=>n});var s=a(95155),l=a(12115);let r=(0,l.createContext)({}),n=()=>{let e=(0,l.useContext)(r);if(!e)throw Error("useNotification must be used within a NotificationProvider");return e},i=e=>{let{children:t}=e,[a,n]=(0,l.useState)([]),i=(0,l.useCallback)(e=>{let t=Date.now()+Math.random(),a={id:t,type:e.type||"info",message:e.message,duration:e.duration||5e3};return n(e=>[...e,a]),a.duration>0&&setTimeout(()=>{o(t)},a.duration),t},[]),o=(0,l.useCallback)(e=>{n(t=>t.filter(t=>t.id!==e))},[]),d=(0,l.useCallback)((e,t)=>i({type:"success",message:e,duration:t}),[i]),c=(0,l.useCallback)((e,t)=>i({type:"error",message:e,duration:t}),[i]),m=(0,l.useCallback)((e,t)=>i({type:"warning",message:e,duration:t}),[i]),u=(0,l.useCallback)((e,t)=>i({type:"info",message:e,duration:t}),[i]),x=(0,l.useCallback)(()=>{n([])},[]);return(0,s.jsx)(r.Provider,{value:{notifications:a,addNotification:i,removeNotification:o,showSuccess:d,showError:c,showWarning:m,showInfo:u,clearAll:x},children:t})}}},e=>{var t=t=>e(e.s=t);e.O(0,[930,568,422,928,696,465,441,517,358],()=>t(26780)),_N_E=e.O()}]);