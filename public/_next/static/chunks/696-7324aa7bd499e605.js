"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[696],{34696:(t,e,a)=>{a.d(e,{A:()=>c,AuthProvider:()=>s});var o=a(95155),n=a(12115),i=a(76046),l=a(13901),r=a(41738);let d=(0,n.createContext)({}),c=()=>{let t=(0,n.useContext)(d);if(!t)throw Error("useAuth must be used within an AuthProvider");return t},s=t=>{let{children:e}=t,[a,c]=(0,n.useState)(null),[s,u]=(0,n.useState)(!0),p=(0,i.useRouter)();(0,n.useEffect)(()=>{let t=localStorage.getItem("token"),e=localStorage.getItem("user");if(t&&e)try{let t=JSON.parse(e);c(t),(0,r.cH)()}catch(t){console.error("Error parsing user data:",t),localStorage.removeItem("token"),localStorage.removeItem("user")}u(!1)},[]);let g=async t=>{try{let{token:e,data:a}=(await l.R2.login(t)).data;return localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(a)),c(a),(0,r.cH)(),{success:!0,user:a}}catch(t){var e,a;return console.error("Login error:",t),{success:!1,error:(null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Login failed"}}},v=async t=>{try{let{token:e,data:a}=(await l.R2.register(t)).data;return localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(a)),c(a),(0,r.cH)(),{success:!0,user:a}}catch(t){var e,a;return console.error("Registration error:",t),{success:!1,error:(null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Registration failed"}}};return(0,o.jsx)(d.Provider,{value:{user:a,loading:s,login:g,register:v,logout:()=>{l.R2.logout(),c(null),(0,r.G1)(),p.push("/login")},isAuthenticated:()=>!!a,hasRole:t=>(null==a?void 0:a.role)===t,hasAnyRole:t=>t.includes(null==a?void 0:a.role)},children:e})}},13901:(t,e,a)=>{a.d(e,{Ay:()=>g,Pt:()=>s,R2:()=>n,TB:()=>i,WB:()=>c,i9:()=>p,rC:()=>u,wH:()=>r,xg:()=>l,zZ:()=>d});let o=a(82651).A.create({baseURL:"",headers:{"Content-Type":"application/json"}});o.interceptors.request.use(t=>{{let e=localStorage.getItem("token");e&&(t.headers.Authorization="Bearer ".concat(e))}return t},t=>Promise.reject(t)),o.interceptors.response.use(t=>t,t=>{var e;return(null===(e=t.response)||void 0===e?void 0:e.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(t)});let n={login:t=>o.post("/api/login",{collection:"users",data:t}),register:t=>o.post("/api/register",{collection:"users",data:t}),logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("user")},getCurrentUser:()=>{{let t=localStorage.getItem("user");return t?JSON.parse(t):null}}},i={getAll:()=>o.get("/api/getAll?collection=donations"),getById:t=>o.get("/api/get?collection=donations&id=".concat(t)),create:t=>o.post("/api/add",{collection:"donations",data:{...t,createdAt:new Date().toISOString(),status:t.status||"pending"}}),update:(t,e)=>o.put("/api/update",{collection:"donations",id:t,data:{...e,updatedAt:new Date().toISOString()}}),delete:t=>o.delete("/api/delete?collection=donations&id=".concat(t)),uploadReceipt:(t,e)=>o.post("/api/add",{collection:"receipts",data:{donationId:t,uploadedAt:new Date().toISOString()}}),getByStatus:t=>o.get("/api/getAll?collection=donations").then(e=>{var a;return{...e,data:{donations:(null===(a=e.data.data)||void 0===a?void 0:a.filter(e=>e.status===t))||[]}}})},l={getAll:()=>o.get("/api/getAll?collection=calamities").then(t=>({...t,data:{calamities:t.data.data||[]}})),getById:t=>o.get("/api/get?collection=calamities&id=".concat(t)),getActive:()=>o.get("/api/getAll?collection=calamities").then(t=>{var e;return{...t,data:{calamities:(null===(e=t.data.data)||void 0===e?void 0:e.filter(t=>"active"===t.status))||[]}}}),create:t=>o.post("/api/add",{collection:"calamities",data:{...t,createdAt:new Date().toISOString()}}),update:(t,e)=>o.put("/api/update",{collection:"calamities",id:t,data:{...e,updatedAt:new Date().toISOString()}})},r={getAll:()=>o.get("/api/getAll?collection=tracking").then(t=>({...t,data:{tracking:t.data.data||[]}})),getById:t=>o.get("/api/get?collection=tracking&id=".concat(t)),getByDonation:t=>o.get("/api/getAll?collection=tracking").then(e=>{var a;return{...e,data:(null===(a=e.data.data)||void 0===a?void 0:a.filter(e=>e.donationId===t))||[]}}),create:t=>o.post("/api/add",{collection:"tracking",data:{...t,createdAt:new Date().toISOString()}}),updateStatus:(t,e)=>o.put("/api/update",{collection:"tracking",id:t,data:{...e,updatedAt:new Date().toISOString()}}),delete:t=>o.delete("/api/delete?collection=tracking&id=".concat(t)),uploadProof:(t,e)=>{if(e instanceof FormData){let a=e.get("fileName"),n=e.get("fileType"),i=e.get("uploadedBy"),l=e.get("uploadedById"),r=e.get("uploadedAt"),d=e.get("fileData");return o.post("/api/uploadProof",{trackingId:t,fileName:a,fileType:n,uploadedBy:i,uploadedById:l,uploadedAt:r,fileData:d})}return o.post("/api/add",{collection:"proofOfDistribution",data:{trackingId:t,...e,createdAt:new Date().toISOString()}})},getProof:t=>o.get("/api/getAll?collection=proofOfDistribution").then(e=>{let a=e.data.data||[];return t?{...e,data:a.filter(e=>e.trackingId===t)}:{...e,data:a}})},d={getStats:async()=>{try{let[t,e,a,n]=await Promise.all([o.get("/api/getAll?collection=donations"),o.get("/api/getAll?collection=calamities").catch(()=>({data:{data:[]}})),o.get("/api/getAll?collection=users").catch(()=>({data:{data:[]}})),o.get("/api/getAll?collection=tracking").catch(()=>({data:{data:[]}}))]),i=t.data.data||[],l=e.data.data||[],r=a.data.data||[],d=n.data.data||[],c=i.filter(t=>{var e;return(null===(e=t.type)||void 0===e?void 0:e.toLowerCase())==="monetary"}).length,s=i.filter(t=>{var e,a;return(null===(e=t.type)||void 0===e?void 0:e.toLowerCase())==="in-kind"||(null===(a=t.type)||void 0===a?void 0:a.toLowerCase())==="inkind"}).length,u=[];return c>0&&u.push({name:"Monetary",value:c}),s>0&&u.push({name:"In-Kind",value:s}),{data:{totalDonations:i.length,totalAmount:i.filter(t=>{var e;return(null===(e=t.type)||void 0===e?void 0:e.toLowerCase())==="monetary"}).reduce((t,e)=>t+(parseFloat(e.amount)||0),0),verifiedDonations:i.filter(t=>{var e;return(null===(e=t.status)||void 0===e?void 0:e.toLowerCase())==="verified"}).length,pendingDonations:i.filter(t=>{var e;return(null===(e=t.status)||void 0===e?void 0:e.toLowerCase())==="pending"||!t.status}).length,deliveredDonations:d.filter(t=>{var e;return(null===(e=t.status)||void 0===e?void 0:e.toLowerCase())==="delivered"}).length,activeCalamities:l.filter(t=>{var e;return(null===(e=t.status)||void 0===e?void 0:e.toLowerCase())==="active"}).length,activeUsers:r.length,donationsByType:u}}}catch(t){return console.error("Error fetching dashboard stats:",t),{data:{}}}},getDonationTrends:async()=>{try{let t=(await o.get("/api/getAll?collection=donations")).data.data||[],e=[];for(let a=6;a>=0;a--){let o=new Date;o.setDate(o.getDate()-a);let n=o.toLocaleDateString("en-US",{month:"short",day:"numeric"}),i=t.filter(t=>new Date(t.createdAt).toDateString()===o.toDateString());e.push({date:n,donations:i.length,amount:i.filter(t=>{var e;return(null===(e=t.type)||void 0===e?void 0:e.toLowerCase())==="monetary"}).reduce((t,e)=>t+(parseFloat(e.amount)||0),0)})}return{data:{trends:e}}}catch(t){return console.error("Error fetching donation trends:",t),{data:{trends:[]}}}},getRecentActivity:()=>o.get("/api/getAll?collection=donations").then(t=>({data:{activity:(t.data.data||[]).sort((t,e)=>new Date(e.createdAt)-new Date(t.createdAt)).slice(0,10).map(t=>({title:"".concat("monetary"===t.type?"Monetary":"In-Kind"," Donation"),description:"monetary"===t.type?"Amount: â‚±".concat(t.amount):"Item: ".concat(t.itemName||"N/A"),status:t.status||"pending",createdAt:t.createdAt,timestamp:t.createdAt}))}}))},c={getAll:()=>o.get("/api/getAll?collection=feedback").then(t=>({...t,data:{feedbacks:t.data.data||[]}})),create:t=>o.post("/api/add",{collection:"feedback",data:{...t,createdAt:new Date().toISOString()}}),update:(t,e)=>o.put("/api/update",{collection:"feedback",id:t,data:{...e,updatedAt:new Date().toISOString()}}),delete:t=>o.delete("/api/delete?collection=feedback&id=".concat(t)),getByDonation:t=>o.get("/api/getAll?collection=feedback").then(e=>{var a;return{...e,data:(null===(a=e.data.data)||void 0===a?void 0:a.filter(e=>e.donationId===t))||[]}})},s={getDonationReport:async t=>{try{let[t,e]=await Promise.all([o.get("/api/getAll?collection=donations"),o.get("/api/getAll?collection=tracking").catch(()=>({data:{data:[]}}))]),a=t.data.data||[],n=e.data.data||[],i={};n.forEach(t=>{i[t.donationId]=t});let l=a.map(t=>{let e=i[t.id];return{...t,trackingStatus:(null==e?void 0:e.status)||null,displayStatus:(null==e?void 0:e.status)||t.status||"pending"}}),r={totalDonations:a.length,totalAmount:a.filter(t=>{var e;return(null===(e=t.type)||void 0===e?void 0:e.toLowerCase())==="monetary"}).reduce((t,e)=>t+(parseFloat(e.amount)||0),0),verifiedDonations:a.filter(t=>{var e;return(null===(e=t.status)||void 0===e?void 0:e.toLowerCase())==="verified"}).length,pendingDonations:a.filter(t=>{var e;return(null===(e=t.status)||void 0===e?void 0:e.toLowerCase())==="pending"||!t.status}).length,deliveredDonations:n.filter(t=>{var e;return(null===(e=t.status)||void 0===e?void 0:e.toLowerCase())==="delivered"}).length};return{...t,data:{donations:l,summary:r}}}catch(t){return console.error("Error fetching donation report:",t),{data:{donations:[],summary:{}}}}},getCalamityReport:t=>o.get("/api/get?collection=calamities&id=".concat(t)),getOverallReport:async()=>{try{let[t,e]=await Promise.all([o.get("/api/getAll?collection=donations"),o.get("/api/getAll?collection=tracking").catch(()=>({data:{data:[]}}))]),a=t.data.data||[],n=e.data.data||[],i={};n.forEach(t=>{i[t.donationId]=t});let l=a.map(t=>{let e=i[t.id];return{...t,trackingStatus:(null==e?void 0:e.status)||null,displayStatus:(null==e?void 0:e.status)||t.status||"pending"}}),r={totalDonations:a.length,totalAmount:a.filter(t=>{var e;return(null===(e=t.type)||void 0===e?void 0:e.toLowerCase())==="monetary"}).reduce((t,e)=>t+(parseFloat(e.amount)||0),0),verifiedDonations:a.filter(t=>{var e;return(null===(e=t.status)||void 0===e?void 0:e.toLowerCase())==="verified"}).length,pendingDonations:a.filter(t=>{var e;return(null===(e=t.status)||void 0===e?void 0:e.toLowerCase())==="pending"||!t.status}).length,deliveredDonations:n.filter(t=>{var e;return(null===(e=t.status)||void 0===e?void 0:e.toLowerCase())==="delivered"}).length};return{...t,data:{donations:l,summary:r}}}catch(t){return console.error("Error fetching overall report:",t),{data:{donations:[],summary:{}}}}}},u={getAll:()=>o.get("/api/getAll?collection=volunteerApplications").then(t=>({...t,data:{applications:t.data.data||[]}})),getById:t=>o.get("/api/get?collection=volunteerApplications&id=".concat(t)),getByCalamity:t=>o.get("/api/getAll?collection=volunteerApplications").then(e=>({...e,data:(e.data.data||[]).filter(e=>e.calamityId===t)})),getByVolunteer:t=>o.get("/api/getAll?collection=volunteerApplications").then(e=>({...e,data:(e.data.data||[]).filter(e=>e.volunteerId===t)})),create:t=>o.post("/api/add",{collection:"volunteerApplications",data:{...t,createdAt:new Date().toISOString(),status:"pending"}}),update:(t,e)=>o.put("/api/update",{collection:"volunteerApplications",id:t,data:{...e,updatedAt:new Date().toISOString()}}),delete:t=>o.delete("/api/delete?collection=volunteerApplications&id=".concat(t)),approve:t=>o.put("/api/update",{collection:"volunteerApplications",id:t,data:{status:"approved",updatedAt:new Date().toISOString()}}),reject:(t,e)=>o.put("/api/update",{collection:"volunteerApplications",id:t,data:{status:"rejected",rejectionReason:e,updatedAt:new Date().toISOString()}}),markAsCompleted:t=>o.put("/api/update",{collection:"volunteerApplications",id:t,data:{status:"completed",completedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}})},p={getAll:()=>o.get("/api/getAll?collection=notifications").then(t=>({...t,data:{notifications:t.data.data||[]}})),create:t=>o.post("/api/add",{collection:"notifications",data:{...t,read:!1,createdAt:new Date().toISOString()}}),markAsRead:t=>o.put("/api/update",{collection:"notifications",id:t,data:{read:!0,updatedAt:new Date().toISOString()}}),markAllAsRead:async()=>{try{let t=((await o.get("/api/getAll?collection=notifications")).data.data||[]).filter(t=>!t.read).map(t=>o.put("/api/update",{collection:"notifications",id:t.id,data:{read:!0,updatedAt:new Date().toISOString()}}));return await Promise.all(t),{data:{success:!0}}}catch(t){return console.error("Error marking all as read:",t),{data:{success:!1}}}},delete:t=>o.delete("/api/delete?collection=notifications&id=".concat(t))},g=o},41738:(t,e,a)=>{a.d(e,{G1:()=>c,L2:()=>p,_J:()=>g,cH:()=>d,nE:()=>u,q2:()=>v});var o=a(71319),n=a(2818);let i=null,l=()=>{if(!i){let t=n.env.NEXT_PUBLIC_SOCKET_URL||"http://localhost:5000";i=(0,o.io)(t,{autoConnect:!1,reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:5});{let t=localStorage.getItem("token");t&&(i.auth={token:t})}i.on("connect",()=>{console.log("Socket connected:",i.id)}),i.on("disconnect",()=>{console.log("Socket disconnected")}),i.on("connect_error",t=>{console.warn("Socket connection error (this is optional):",t.message)})}return i},r=()=>i||l(),d=()=>{let t=r();return t.connected||t.connect(),t},c=()=>{i&&i.connected&&i.disconnect()},s=(t,e)=>{let a=r();return a.on(t,e),()=>a.off(t,e)},u=t=>s("donation:update",t),p=t=>s("tracking:update",t),g=t=>s("notification:new",t),v=t=>s("dashboard:update",t)}}]);